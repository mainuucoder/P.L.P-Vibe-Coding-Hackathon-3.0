{% extends 'dashboard/base3.html' %}
{% load static %}
{% block content %}
{% load bootstrap5 %}
{% load humanize %}
<style>
  table {
    font-size: 13px !important;
    text-align: center;
    width: 95%;
    margin: auto;
    text-align: center;
  }

  /*Make alternating colors for the table rows*/
  .table tr:nth-child(odd) {
    /* background: #B8CAE4 */
  }

  .table tr:nth-child(even) {
    /* background: #dae5f4 */
  }

  thead {
    background-color: #96bcee;
    color: #000;
  }

  th {
    background-color: #106EEA;
    color: #000;
  }

  .display_table {
    border-bottom-right-radius: 20px;
    /*border-bottom-left-radius: 20px;*/
    padding-left: 5px;
    padding-right: 5px;
    padding-bottom: 20px;
    /* box-shadow: 12px 12px 20px 6px #2e6da4; */
  }

  td {
    padding: 6px;
    line-height: 1.428571429;
    vertical-align: top;
    border-top: 1px solid #dddddd;
    text-align: justify;
    font-size: 16px;
  }

  .page_links {
    cursor: pointer;

  }

  .pagination {
    float:right;
  }

  .pagination a {
    color: black;
    float: left;
    padding: 8px 16px;
    text-decoration: none;
  }

  .pagination a.active {
    background-color: #4CAF50;
    color: white;
  }

  .pagination a:hover:not(.active) {
    background-color: #ddd;
  }

  .actionbtns {
    cursor: pointer;

  }





  .dropbtn {
    color: #000;
    padding: 1px;
    font-size: 1px;
    border: none;
    cursor: pointer;
  }

  /* The container <div> - needed to position the dropdown content */
  .dropdown {
    position: relative;
    display: inline-block;
  }

  /* Dropdown Content (Hidden by Default) */
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 200px;
    left: -144px;
    height: 300px !important;
    overflow: auto;
    box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
    z-index: 9;
  }

  /* Links inside the dropdown */
  .dropdown-content a {
    color: black;
    /* padding: 12px 16px; */
    text-decoration: none;
    display: block;
  }

  .btn-app-dropdown:hover {
    background-color: #ccc;
  }

  .btn-app-dropdown {
    Border-bottom: 1px solid #ccc
  }

  /* Change color of dropdown links on hover */
  /* .dropdown-content a:hover {background-color: #f1f1f1} */

  /* Show the dropdown menu on hover */
  .dropdown:hover .dropdown-content {
    display: block;
  }

  /* Change the background color of the dropdown button when the dropdown content is shown */
  .dropdown:hover .dropbtn {}








  th {
    text-transform: uppercase;
  }



  .btn-app-dropdown {
    text-align: left;
  }

  .graphs {
    min-height: 200px;
  }
  td{
    font-size: 11px !important;
  text-align: left !important;
  font-family:"Roboto", sans-serif !important;
  
  
  }

</style>
{% if messages %}
{% for message in messages %}
<script>
  notify('{{message.level_tag}}', "{{message}}");
</script>

{% endfor %}

{% endif %}

<div class="inner" style="">

  <div class="row">
    <div class="col-lg-12">
      <h4> Tasks</h4>
      {% if user.is_superuser %}
      <span class="btn btn-success menu_btn" role="{{level}}" id="addSurvey" style="float:right;margin-top: -35px;"
        role="addForum">+ Add New</span>
        {% endif %}
    </div>
  </div>
  <hr />
  <!--BLOCK SECTION -->
  <div class="row">
    <div class="col-12">
    <div class="card">
      <div class="card-body ">
        <form class="col-lg-12" id="ToEditForm">

          <table class='table loadtable export-table table-striped  text-nowrap w-100' id="">
            <thead style="font-size: 11px;">
              <tr>
                <th>#</th>
                <th>TITLE</th>
                {% if user.is_admin or user.is_ICT_Admin %}
                <th>INSTITUTION</th>
                {% endif %}
                <th style="display:none">DESCRIPTION</th>
                <th>INVITED</th>
                <th>RESPONDED</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            {% for instance in Surveys %}
            <tr>
              <td>{{forloop.counter}}</td>
              <td style="text-transform:uppercase !important;">{{instance.name|safe}}</td>
              {% if user.is_admin or user.is_ICT_Admin %}
              <td style="text-transform:uppercase !important;">
                
                {% if instance.institution %}
                {{instance.institution|safe}}
                {% else %}
                All institutions
                {% endif %}


              </td>
              {% endif %}

              <td style="display:none;text-transform:uppercase !important;">{{instance.Brief_Description|safe}}</td>
              <td>
                {% if instance.invited %}
                {{instance.invited}}
                {% else %}
                0
                {% endif %}
              </td>
              <td>
                {% if instance.responded %}
                {{instance.responded}}
                {% else %}
                0
                {% endif %}
              </td>
              <td>


                <div class="dropdown">
                  <div class="dropbtn" style="color:#000;background:#fff;font-size:12px;"><span
                      class="btn btn-success">more <i class="fa fa-arrow-down "></i></span></div>
                  <div class="dropdown-content row" style="margin-top:-200px;min-height: 200px;max-height: 400px;overflow: auto;">
                    {% if user.is_superuser %}
                      <span class="btn col-sm-12 btn-app-dropdown update_items actionbtns" role="{{instance.id}}">
                        <i title="Edit Survey" class="fa fa-edit  "></i>
                        Edit </span><br>
                      <span class="btn col-sm-12 btn-app-dropdown actionbtns AddAudienceRestriction "
                        role='{{instance.id}}'>
                        <i title=" Add Target audience restriction" class=" fa fa-ban" aria-hidden="true"
                          aria-hidden="true" aria-hidden="true"></i>
                        Audience Restriction
                      </span><br>
                      <span class="btn col-sm-12 btn-app-dropdown actionbtns AddQuestions" role='{{instance.id}}'>
                        <i title="Add survey questions" class="fa fa-plus "></i>
                        Add questions
                      </span><br>
                      <span class="btn col-sm-12 btn-app-dropdown actionbtns questions" role='{{instance.id}}'>
                        <i title="View survey questions" class=" fa fa-list" aria-hidden="true"></i>
                        View questions
                      </span><br>
                      <span class="btn col-sm-12 btn-app-dropdown actionbtns AddAudience " role='{{instance.id}}'>
                        <i title=" Add survey audience" class=" fa fa-user-plus" aria-hidden="true" aria-hidden="true"
                          aria-hidden="true"></i>
                        Add audience
                      </span><br>
                      <span class="btn col-sm-12 btn-app-dropdown actionbtns ListSurveyAudience" role='{{instance.id}}'>
                        <i title="View survey audience" class="fa fa-users  " aria-hidden="true"></i>
                        View audience
                      </span><br>
                      {% endif %}
                      <span class="btn col-sm-12 btn-app-dropdown ListSurveyResponcesRecieved" role='{{instance.id}}'
                        name="applications_received">
                        <i title=" List survey responces" class="fa fa-list  actionbtns " role='{{instance.id}}'
                          aria-hidden="true"></i>
                        List  responses
                      </span><br>
  
             
  
  
                      {% if instance.status == 'responces' %}
                      <span class="btn col-sm-12 btn-app-dropdown actionbtns export_survey_responce fa fa-download"
                        role='{{instance.id}}'>
                        <i title="Export Responces" class=" " aria-hidden="true"></i>
                        Export Responses
  
  
                      </span>
                      {% else %}
  
                      {% endif %}
  
                    </div>
                   

                  </div>
                


                <!-- <i title="Edit Survey" class="fa fa-edit  update_items actionbtns" role="{{instance.id}}"></i>
                   
                       <i title="Add questions" class="fa fa-plus actionbtns AddQuestions" role='{{instance.id}}'></i> 
                       <i title="View Questions" class="actionbtns questions fa fa-list" aria-hidden="true" role='{{instance.id}}'></i> 
                       <i title="Add audience" class=" actionbtns AddAudience fa fa-user-plus" aria-hidden="true" aria-hidden="true" role='{{instance.id}}' aria-hidden="true"></i> 
                       <i title="View audience" class="fa fa-address-book  actionbtns ListSurveyAudience" role='{{instance.id}}' aria-hidden="true"></i> 
                       <i title="View Responces" class="actionbtns ListSurveyResponcesRecieved fa fa-list" aria-hidden="true" role='{{instance.id}}'></i> 
                  
                       <i title="Export Responces for normal questions" class="actionbtns export_survey_responce fa fa-download" aria-hidden="true" role='{{instance.id}}' ></i> 
                       <i style="" title="Export Responces for Table questions" class="export_survey_responce_special actionbtns export_survey_responce_special fa fa-download" role='{{instance.id}}'></i> -->


              </td>
            </tr>
            {% endfor %}
          </table>


        </form>
      </div>
    </div>
  </div>

</div>
</div>
<div class="modal fade" id="modal-staff">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
    </div>
  </div>
</div>
<script src="{% static 'static_assets/js/jquery.min.js' %}"></script>
<script>
  $(document).ready(function () {
    var csrfmiddlewaretoken = '{{csrf_token}}';
    $("#addSurvey").click(function () {
     var level=$(this).attr('role')
      $.post('/dashboard/surveys/create_survey/',{csrfmiddlewaretoken: csrfmiddlewaretoken, level:level}, function (data) {
        $("#modal-staff").modal("show");
        $(".modal-content").html(data)
        //$('.content-wrapper').html(data)
      })

    })

    $(".update_items").click(function () {
      var my_role = $(this).attr('role');
      $.get('/dashboard/surveys/Update_survey/' + my_role, function (data) {
        $("#modal-staff").modal("show");
        $(".modal-content").html(data)
        // $('.content-wrapper').html(data)
      })
    })
    $(".viewSubmissions").click(function () {

      var my_role = $(this).attr('role');


      var my_role = $(this).attr('role');
      $.get('/dashboard/surveys/viewSubmissions/' + my_role, function (data) {

        $('.content-wrapper').html(data)
      })
    })

    $("#AddForum_btn").click(function () {

      $.get('/dashboard/surveys/addSurvey', function (data) {
        $("#modal-staff").modal("show");
        $(".modal-content").html(data)
        // $('.content-wrapper').html(data)
      })

    })

    $(".AddAudienceRestriction").click(function () {
      var surveyId = $(this).attr('role');
      $.get('/dashboard/surveys/AddAudienceRestriction/' + surveyId, function (data) {

        $('.content-wrapper').html(data)
      })
    })

    $(".AddAudience").click(function () {
      var surveyId = $(this).attr('role');
      var csrfmiddlewaretoken = '{{csrf_token}}';
      $.post('/dashboard/surveys/selectAudience/', { csrfmiddlewaretoken: csrfmiddlewaretoken, surveyId: surveyId }, function (data) {

        $('.content-wrapper').html(data)
      })
    })
    $('.ListSurveyAudience').click(function () {
      var surveyId = $(this).attr('role');
      var csrfmiddlewaretoken = '{{csrf_token}}';
      $.post('/dashboard/surveys/list_selectAudience/', { csrfmiddlewaretoken: csrfmiddlewaretoken, surveyId: surveyId }, function (data) {

        $('.content-wrapper').html(data)
      })
    })



    $(".AddQuestions").click(function () {
      var my_role = $(this).attr('role');
      $.get('/dashboard/surveys/ViewQuestions/' + my_role, function (data) {

        $('.content-wrapper').html(data)
      })


    })
    $(".questions").click(function () {
      var survey = $(this).attr('role');
      var csrfmiddlewaretoken = '{{csrf_token}}';
      $.post('/dashboard/surveys/listViewQuestions/', { csrfmiddlewaretoken: csrfmiddlewaretoken, survey: survey }, function (data) {

        $('.content-wrapper').html(data)
      })
    })
    $(".ListSurveyResponcesRecieved").click(function () {
      var survey = $(this).attr('role');
      var csrfmiddlewaretoken = '{{csrf_token}}';
      $.post('/dashboard/surveys/ListSurveyResponcesRecieved/', { csrfmiddlewaretoken: csrfmiddlewaretoken, survey: survey }, function (data) {

        $('.content-wrapper').html(data)
      })
    })
    $(".export_survey_responce").click(function () {
      var survey = $(this).attr('role');
      $(".export_survey_responce_special" + survey).click()

      var csrfmiddlewaretoken = '{{csrf_token}}';
      var url = '/dashboard/surveys/export_survey_responce/' + survey
      window.open(url, '_blank');
      var url = '/dashboard/surveys/export_survey_responce_special/' + survey
      window.open(url, '_blank');

      //  $.post('/dashboard/surveys/export_survey_responce/',{csrfmiddlewaretoken:csrfmiddlewaretoken,survey:survey},function(data){

      // $('.content-wrapper').html(data)
      // })
    })
    $(".export_survey_responce_special").click(function () {

      var survey = $(this).attr('role');
      var csrfmiddlewaretoken = '{{csrf_token}}';
      //  var url='/dashboard/surveys/export_survey_responce/'+survey
      //  window.open(url, '_blank');
      var url = '/dashboard/surveys/export_survey_responce_special/' + survey
      window.open(url, '_blank');

      //  $.post('/dashboard/surveys/export_survey_responce/',{csrfmiddlewaretoken:csrfmiddlewaretoken,survey:survey},function(data){

      // $('.content-wrapper').html(data)
      // })
    })

  })
</script>
{% endblock %}